<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WhatsApp Frontend Clone</title>
  <!-- Bootstrap Icons (SVG icon font) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    :root {
      --wa-green: #128c7e;   /* header */
      --wa-green-dark: #075e54; /* darker header */
      --wa-teal: #00a884;   /* accents */
      --bg-dark: #0b141a;
      --bg-darker: #111b21; /* app background */
      --panel-dark: #202c33; /* panels and chat header */
      --panel-hover: #2b3942; /* hover */
      --text: #e9edef;
      --text-dim: #8696a0;
      --bubble-in: #1f2c33;     /* received */
      --bubble-out: #005c4b;    /* sent */
      --bubble-out-strong: #025149;
      --divider: #1f2c33;
      --shadow: rgba(0,0,0,.3);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans', 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-dark);
      color: var(--text);
    }

    /* Background pattern like WhatsApp */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image:
        radial-gradient(transparent 1px, rgba(255,255,255,.02) 1px),
        radial-gradient(transparent 1px, rgba(255,255,255,.02) 1px);
      background-size: 24px 24px, 24px 24px;
      background-position: 0 0, 12px 12px;
      pointer-events: none;
      z-index: 0;
    }

    .app {
      position: relative;
      z-index: 1;
      height: 100vh;
      max-width: 1400px;
      margin-inline: auto;
      display: grid;
      grid-template-columns: 360px 1fr;
      background: var(--bg-darker);
      box-shadow: 0 10px 30px var(--shadow);
    }

    /* Responsive: stack on mobile like WhatsApp mobile */
    @media (max-width: 960px) {
      .app { grid-template-columns: 1fr; }
      .sidebar { display: var(--sidebar-visible, block); }
      .chat { display: var(--chat-visible, none); }
      .chat.mobile-visible { display: block; }
    }

    .sidebar {
      border-right: 1px solid var(--divider);
      display: grid;
      grid-template-rows: auto auto 1fr;
      background: var(--bg-darker);
    }

    .topbar {
      background: var(--panel-dark);
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid var(--divider);
    }
    .avatar {
      width: 36px; height: 36px;
      border-radius: 50%;
      display: grid; place-items: center;
      font-weight: 700; font-size: 14px;
      color: #fff;
      background: linear-gradient(135deg, #2dd4bf, #22c55e);
      user-select: none;
    }

    .topbar .actions { margin-left: auto; display:flex; gap: 16px; }
    .icon-btn { cursor: pointer; opacity: .9; transition: .2s ease; }
    .icon-btn:hover { opacity: 1; transform: translateY(-1px); }

    .searchbar { padding: 10px; background: var(--bg-darker); border-bottom: 1px solid var(--divider); }
    .searchbar .input {
      display: flex; align-items: center; gap: 8px;
      background: var(--panel-dark);
      border-radius: 10px;
      padding: 10px 12px;
      color: var(--text-dim);
    }
    .searchbar input {
      border: none; outline: none; width: 100%; background: transparent; color: var(--text);
    }

    .chatlist { overflow: auto; }
    .chat-item { display: grid; grid-template-columns: 56px 1fr auto; gap: 12px; padding: 10px 14px; align-items: center; border-bottom: 1px solid transparent; cursor: pointer; }
    .chat-item:hover { background: var(--panel-hover); border-bottom-color: var(--divider); }
    .chat-item.active { background: var(--panel-hover); }
    .chat-item .avatar { width: 48px; height: 48px; font-size: 16px; }
    .chat-item .meta { display: flex; justify-content: space-between; gap: 8px; }
    .chat-item .name { font-weight: 600; }
    .chat-item .last { color: var(--text-dim); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .chat-item .time { color: var(--text-dim); font-size: 12px; }

    .chat { position: relative; display: grid; grid-template-rows: auto 1fr auto; }

    .chat-header { display: flex; align-items: center; gap: 12px; padding: 10px 16px; background: var(--panel-dark); border-left: 1px solid var(--divider); }
    .chat-header .title { display: flex; flex-direction: column; }
    .chat-header .name { font-weight: 600; }
    .chat-header .status { color: var(--text-dim); font-size: 12px; }
    .chat-header .actions { margin-left: auto; display:flex; gap: 16px; }

    .messages {
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120" fill="none"><path d="M40 60h40M60 40v40" stroke="%231f2c33" stroke-width="1" opacity="0.12"/></svg>') center/240px repeat, var(--bg-darker);
      padding: 24px 24px 80px;
      overflow-y: auto;
    }

    .day-sep { text-align: center; margin: 20px 0; }
    .pill { display: inline-block; background: #233138; color: var(--text-dim); padding: 6px 10px; border-radius: 999px; font-size: 12px; }

    .bubble {
      position: relative;
      max-width: min(72%, 560px);
      margin: 6px 0;
      padding: 8px 10px 18px;
      border-radius: 12px;
      line-height: 1.4;
      word-wrap: break-word;
    }
    .from-me { margin-left: auto; background: linear-gradient(180deg, var(--bubble-out) 0%, var(--bubble-out-strong) 100%); }
    .from-them { margin-right: auto; background: var(--bubble-in); }

    .time-status {
      position: absolute; right: 8px; bottom: 4px; display: inline-flex; align-items: center; gap: 4px; font-size: 11px; color: var(--text-dim);
    }

    /* Tails */
    .from-me::after, .from-them::after {
      content: ""; position: absolute; bottom: 0; width: 12px; height: 12px; background: inherit; transform: skewY(35deg);
    }
    .from-me::after { right: -4px; clip-path: polygon(100% 0, 0 0, 100% 100%); }
    .from-them::after { left: -4px; clip-path: polygon(0 0, 0 100%, 100% 0); }

    .attach-preview { margin-top: 6px; border-radius: 8px; overflow: hidden; border: 1px solid #2a3942; }
    .attach-preview .file { display: flex; align-items: center; gap: 8px; padding: 8px 10px; background: rgba(0,0,0,.1); font-size: 13px; }

    .composer {
      position: sticky; bottom: 0; left: 0; right: 0;
      background: var(--panel-dark);
      padding: 10px 12px; display:flex; align-items: center; gap: 10px; border-left: 1px solid var(--divider);
    }
    .composer .field {
      flex: 1; display:flex; align-items: center; gap: 10px; background: #2a3942; border-radius: 10px; padding: 8px 10px;
    }
    .composer input {
      flex:1; border: none; outline: none; background: transparent; color: var(--text);
    }

    .dropdown { position: relative; }
    .menu {
      position: absolute; right: 0; top: calc(100% + 8px);
      background: var(--panel-dark); border: 1px solid var(--divider); border-radius: 8px; padding: 6px; min-width: 200px; box-shadow: 0 10px 30px var(--shadow);
      display: none;
    }
    .menu.show { display: block; }
    .menu button { width: 100%; text-align: left; padding: 10px; background: transparent; color: var(--text); border: none; border-radius: 6px; cursor: pointer; }
    .menu button:hover { background: var(--panel-hover); }

    .attach-panel { position: absolute; bottom: 64px; left: 12px; background: var(--panel-dark); border: 1px solid var(--divider); border-radius: 12px; padding: 8px; display: none; box-shadow: 0 10px 30px var(--shadow); }
    .attach-panel.show { display: grid; gap: 6px; }
    .attach-panel button { display: flex; align-items:center; gap: 8px; padding: 8px 12px; border-radius: 8px; background: transparent; border: none; color: var(--text); cursor:pointer; }
    .attach-panel button:hover { background: var(--panel-hover); }

    /* Back button (mobile) */
    .back-btn { display: none; }
    @media (max-width: 960px) {
      .back-btn { display: inline-flex; }
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar { width: 10px; height: 10px; }
    ::-webkit-scrollbar-thumb { background: #223039; border-radius: 10px; }
    ::-webkit-scrollbar-track { background: transparent; }

    .typing { display: inline-flex; gap: 2px; align-items: center; }
    .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--text-dim); opacity: .5; animation: pulse 1s infinite; }
    .dot:nth-child(2){ animation-delay: .1s; }
    .dot:nth-child(3){ animation-delay: .2s; }
    @keyframes pulse { 0%, 100% { transform: translateY(0); opacity: .4; } 50% { transform: translateY(-2px); opacity: 1; } }

    .hidden { display:none !important; }
  </style>
</head>
<body>
  <div class="app" id="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="topbar">
        <div class="avatar" title="You">RJ</div>
        <div style="font-weight:600">WhatsApp</div>
        <div class="actions">
          <i class="bi bi-broadcast-pin icon-btn" title="Status"></i>
          <i class="bi bi-chat-left-text icon-btn" title="New chat"></i>
          <div class="dropdown">
            <i class="bi bi-three-dots-vertical icon-btn" id="menuToggle" title="Menu"></i>
            <div class="menu" id="menu">
              <button id="newGroup">New group</button>
              <button id="newCommunity">New community</button>
              <button id="starredMsgs">Starred messages</button>
              <button id="settings">Settings</button>
              <button id="logOut">Log out</button>
            </div>
          </div>
        </div>
      </div>

      <div class="searchbar">
        <div class="input">
          <i class="bi bi-search"></i>
          <input id="search" type="text" placeholder="Search or start new chat" />
        </div>
      </div>

      <div class="chatlist" id="chatlist">
        <!-- Chat items populated by JS -->
      </div>
    </aside>

    <!-- Chat area -->
    <main class="chat" id="chat">
      <div class="chat-header">
        <button class="back-btn icon-btn" id="backBtn" title="Back"><i class="bi bi-arrow-left"></i></button>
        <div class="avatar" id="chatAvatar">AL</div>
        <div class="title">
          <div class="name" id="chatName">Alya</div>
          <div class="status" id="chatStatus">online</div>
        </div>
        <div class="actions">
          <i class="bi bi-search icon-btn" title="Search in chat"></i>
          <i class="bi bi-telephone icon-btn" title="Voice call"></i>
          <i class="bi bi-camera-video icon-btn" title="Video call"></i>
          <div class="dropdown">
            <i class="bi bi-three-dots-vertical icon-btn" id="chatMenuToggle" title="Chat menu"></i>
            <div class="menu" id="chatMenu">
              <button>Contact info</button>
              <button>Select messages</button>
              <button>Mute notifications</button>
              <button>Clear chat</button>
              <button>Delete chat</button>
            </div>
          </div>
        </div>
      </div>

      <section class="messages" id="messages">
        <!-- Messages populated by JS -->
      </section>

      <div class="composer">
        <div class="dropdown">
          <button class="icon-btn" id="attachBtn" title="Attach"><i class="bi bi-paperclip"></i></button>
          <div class="attach-panel" id="attachPanel">
            <button><i class="bi bi-file-earmark-image"></i><span>Photos & Videos</span></button>
            <button><i class="bi bi-person-badge"></i><span>Contact</span></button>
            <button><i class="bi bi-file-earmark"></i><span>Document</span></button>
            <button><i class="bi bi-geo-alt"></i><span>Location</span></button>
            <button><i class="bi bi-camera"></i><span>Camera</span></button>
          </div>
        </div>
        <div class="field">
          <input id="composerInput" type="text" placeholder="Type a message" />
          <button class="icon-btn" id="emojiBtn" title="Stickers"><i class="bi bi-stickies"></i></button>
        </div>
        <button class="icon-btn" id="micBtn" title="Hold to record"><i class="bi bi-mic-fill"></i></button>
        <button class="icon-btn hidden" id="sendBtn" title="Send"><i class="bi bi-send-fill"></i></button>
      </div>
    </main>
  </div>

  <script>
    // --- Mock Data ---
    const chats = [
      { id: 'alya', name: 'Alya', initials: 'AL', last: 'Ok, besok jam 7 ya', time: '18:26', unread: 2 },
      { id: 'bima', name: 'Bima', initials: 'BM', last: 'Otw...', time: '17:40', unread: 0 },
      { id: 'kelas rpl', name: 'Kelas RPL X-1', initials: 'KR', last: 'File absen sudah diupload', time: '16:05', unread: 5 },
      { id: 'dev team', name: 'Dev Team', initials: 'DT', last: 'Push terakhir udah sukses', time: '09:14', unread: 0 },
      { id: 'mama', name: 'Mama', initials: 'MA', last: 'Jangan lupa beli telur', time: 'Kemarin', unread: 1 },
    ];

    const chatHistory = {
      'alya': [
        { from: 'them', text: 'Halo, tugas sudah kamu kirim?', time: '18:20', status: 'delivered' },
        { from: 'me', text: 'Sudah kak. Cek email ya', time: '18:21', status: 'read' },
        { from: 'them', text: 'Ok, besok jam 7 ya', time: '18:26', status: 'delivered' },
      ],
      'bima': [
        { from: 'them', text: 'Bro, berangkat sekarang?', time: '17:35', status: 'delivered' },
        { from: 'me', text: 'Otw...', time: '17:40', status: 'sent' },
      ],
      'kelas rpl': [
        { from: 'them', text: 'File absen sudah diupload', time: '16:05', status: 'read', attach: { name: 'absen-rpl.xlsx', size: '32 KB' } },
      ],
      'dev team': [
        { from: 'them', text: 'Push terakhir udah sukses', time: '09:14', status: 'read' },
      ],
      'mama': [
        { from: 'them', text: 'Jangan lupa beli telur', time: 'Kemarin', status: 'delivered' },
      ],
    };

    // --- DOM Helpers ---
    const $ = (sel, el = document) => el.querySelector(sel);
    const $$ = (sel, el = document) => Array.from(el.querySelectorAll(sel));

    const chatlistEl = $('#chatlist');
    const messagesEl = $('#messages');
    const chatNameEl = $('#chatName');
    const chatStatusEl = $('#chatStatus');
    const chatAvatarEl = $('#chatAvatar');
    const composerInput = $('#composerInput');
    const micBtn = $('#micBtn');
    const sendBtn = $('#sendBtn');
    const backBtn = $('#backBtn');

    let currentChatId = chats[0].id;

    function makeChatItem(item){
      const wrap = document.createElement('div');
      wrap.className = 'chat-item';
      wrap.dataset.id = item.id;
      wrap.innerHTML = `
        <div class="avatar">${item.initials}</div>
        <div>
          <div class="meta">
            <div class="name">${item.name}</div>
            <div class="time">${item.time}</div>
          </div>
          <div class="meta">
            <div class="last">${item.last}</div>
            <div>${item.unread ? `<span class="pill">${item.unread}</span>` : ''}</div>
          </div>
        </div>
      `;
      wrap.addEventListener('click', () => openChat(item.id));
      return wrap;
    }

    function renderChatList(filter = ''){
      chatlistEl.innerHTML = '';
      chats
        .filter(c => c.name.toLowerCase().includes(filter.toLowerCase()))
        .forEach(c => {
          const el = makeChatItem(c);
          if (c.id === currentChatId) el.classList.add('active');
          chatlistEl.appendChild(el);
        });
    }

    function messageStatusIcon(status){
      if(status === 'sent') return '<i class="bi bi-check2"></i>';
      if(status === 'delivered') return '<i class="bi bi-check2-all"></i>';
      if(status === 'read') return '<i class="bi bi-check2-all" style="opacity:1"></i>';
      return '';
    }

    function makeBubble(msg){
      const div = document.createElement('div');
      div.className = `bubble ${msg.from === 'me' ? 'from-me' : 'from-them'}`;
      let html = '';
      if(msg.text) html += `<div>${msg.text}</div>`;
      if(msg.attach){
        html += `<div class="attach-preview"><div class="file"><i class="bi bi-file-earmark"></i>${msg.attach.name} Â· ${msg.attach.size}</div></div>`;
      }
      html += `<div class="time-status">${msg.time} ${messageStatusIcon(msg.status)}</div>`;
      div.innerHTML = html;
      return div;
    }

    function renderMessages(){
      messagesEl.innerHTML = '';
      const day = document.createElement('div');
      day.className = 'day-sep';
      day.innerHTML = '<span class="pill">Today</span>';
      messagesEl.appendChild(day);
      chatHistory[currentChatId].forEach(m => messagesEl.appendChild(makeBubble(m)));
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function openChat(id){
      currentChatId = id;
      $$('.chat-item', chatlistEl).forEach(i => i.classList.remove('active'));
      const active = $(`.chat-item[data-id="${id}"]`, chatlistEl);
      if (active) active.classList.add('active');
      const info = chats.find(c => c.id === id);
      chatNameEl.textContent = info.name;
      chatAvatarEl.textContent = info.initials;
      chatStatusEl.textContent = 'online';
      renderMessages();

      // Mobile: hide sidebar, show chat
      if (window.innerWidth <= 960) {
        document.querySelector('.sidebar').style.setProperty('--sidebar-visible', 'none');
        document.querySelector('.chat').classList.add('mobile-visible');
      }
    }

    function sendMessage(text){
      if(!text.trim()) return;
      const now = new Date();
      const pad = n => n.toString().padStart(2,'0');
      const time = `${pad(now.getHours())}:${pad(now.getMinutes())}`;
      const msg = { from: 'me', text, time, status: 'sent' };
      chatHistory[currentChatId] = chatHistory[currentChatId] || [];
      chatHistory[currentChatId].push(msg);
      messagesEl.appendChild(makeBubble(msg));
      messagesEl.scrollTop = messagesEl.scrollHeight;
      composerInput.value = '';
      toggleSendMic();

      // Simulate delivery and reply
      setTimeout(() => {
        msg.status = 'delivered';
        renderMessages();
      }, 700);
      setTimeout(() => {
        const reply = { from: 'them', text: 'Noted ðŸ‘', time, status: 'delivered' };
        chatHistory[currentChatId].push(reply);
        renderMessages();
      }, 1200);
    }

    function toggleSendMic(){
      const hasText = composerInput.value.trim().length > 0;
      micBtn.classList.toggle('hidden', hasText);
      sendBtn.classList.toggle('hidden', !hasText);
    }

    // --- Event wiring ---
    composerInput.addEventListener('input', toggleSendMic);
    composerInput.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' && !e.shiftKey){
        e.preventDefault();
        sendMessage(composerInput.value);
      }
    });
    sendBtn.addEventListener('click', () => sendMessage(composerInput.value));

    // Simple mic hold animation
    let holding = false, holdTimer;
    micBtn.addEventListener('mousedown', () => {
      holding = true;
      micBtn.style.transform = 'scale(1.2)';
      micBtn.style.filter = 'drop-shadow(0 0 6px var(--wa-teal))';
      holdTimer = setTimeout(() => {
        if(holding){ chatStatusEl.innerHTML = '<span class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>'; }
      }, 300);
    });
    ['mouseup','mouseleave','touchend'].forEach(evt => micBtn.addEventListener(evt, () => {
      holding = false;
      clearTimeout(holdTimer);
      micBtn.style.transform = '';
      micBtn.style.filter = '';
      chatStatusEl.textContent = 'online';
    }));

    // Menus
    const menuToggle = $('#menuToggle');
    const menu = $('#menu');
    const chatMenuToggle = $('#chatMenuToggle');
    const chatMenu = $('#chatMenu');
    menuToggle.addEventListener('click', () => menu.classList.toggle('show'));
    chatMenuToggle.addEventListener('click', () => chatMenu.classList.toggle('show'));
    document.addEventListener('click', (e) => {
      if(!menu.contains(e.target) && e.target !== menuToggle) menu.classList.remove('show');
      if(!chatMenu.contains(e.target) && e.target !== chatMenuToggle) chatMenu.classList.remove('show');
    });

    // Attach panel
    const attachBtn = $('#attachBtn');
    const attachPanel = $('#attachPanel');
    attachBtn.addEventListener('click', () => attachPanel.classList.toggle('show'));
    document.addEventListener('click', (e) => {
      if(!attachPanel.contains(e.target) && e.target !== attachBtn) attachPanel.classList.remove('show');
    });

    // Search filter
    const search = $('#search');
    search.addEventListener('input', () => renderChatList(search.value));

    // Back button (mobile)
    backBtn.addEventListener('click', () => {
      document.querySelector('.sidebar').style.setProperty('--sidebar-visible', 'block');
      document.querySelector('.chat').classList.remove('mobile-visible');
    });

    // Init
    renderChatList();
    openChat(currentChatId);
  </script>
</body>
</html>
